<% var rootlink = config.root; %>
<% if (theme.search.enable) { %>
<script src="<%- rootlink %>js/searcher.js"></script>
<script>
    const searcher = new Searcher("<%- config.root + (theme.search.path || "search.json") %>");
    searcher.init().then(() => {
        let input = document.getElementsByClassName("search-bar")[0];
        let timeline = document.getElementsByClassName("timeline");
        input.addEventListener("input", () => {
            let result = searcher.search(input.value).map(e => e.path);
            for (let t of timeline)
                if (result.indexOf(t.getAttribute("path")) == -1)
                    t.classList.add("hide");
                else
                    t.classList.remove("hide");
        });
    });
</script>
<% } %>
<div id="archives">
    <% if (theme.search.enable) { %>
    <div class="search-mask" style="z-index: <%= site.posts.length + 1 %>"></div>
    <input class="search-bar" placeholder="Search..." style="z-index: <%= site.posts.length + 2 %>">
    <% } %>
    <% site.posts.forEach(function(post, id){ %>
    <div class="timeline" path="<%- rootlink %><%- post.path %>" style="z-index: <%= site.posts.length - id %>">
        <div class="timeline-tail"></div>
        <div class="timeline-content">
            <div class="item-time"><%- date(post.date, "YYYY/M/D") %></div>
            <a href="<%- rootlink %><%- post.path %>">
                <h3><%= post.title %></h3>
            </a>
            <div class="info">
                <% if(post.categories && post.categories.data.length!=0){ %>
                <span class="category">
                    <a href="<%- rootlink %><%- post.categories.data[0].path %>">
                        <span class="icon">
                            <svg class="fa-icon"><use xlink:href="#bookmark-solid"></use></svg>
                        </span>
                        <%= post.categories.data[0].name %>
                    </a>
                </span>
                <% } %>
                <% if (post.tags && post.tags.data.length != 0){ %>
                <span class="tags">
                    <span class="icon">
                        <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
                    </span>
                    <% post.tags.data.forEach(function(data) {%>
                    <span class="tag">
                        <%
                            var color = ["color: #ffa2c4", "color: #00bcd4", "color: #03a9f4", "color: #00a596", "color: #ff7d73"];
                            var num = Math.floor(Math.random() * color.length);
                        %>
                        <a href="<%- rootlink %><%- data.path %>" style="<%- color[num] %>">
                            <%= data.name %>
                        </a>
                    </span>
                    <% }); %>
                </span>
                <% } %>
            </div>
        </div>
    </div>
    <% }); %>
</div>